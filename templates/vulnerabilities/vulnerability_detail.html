{% extends 'base.html' %}
{% load static %}

{% block title %}{{ vulnerability.name }} - Vulnerability Management System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/details.css' %}">
{% endblock %}

{% block content %}
<div class="detail-card">
    <div class="detail-card-header">
        <h2 class="detail-card-title">Vulnerability Details</h2>
        <div class="detail-actions">
            <a href="{% url 'vulnerability_list' %}" class="btn btn-secondary">Back to List</a>
        </div>
    </div>
    <div class="card-body">
        <h3 class="detail-section-title">{{ vulnerability.name }}</h3>

        <div class="detail-grid">
            <div>
                <div class="detail-item">
                    <span class="detail-label">Severity</span>
                    <div class="detail-value severity-{% if vulnerability.severity == 4 %}critical{% elif vulnerability.severity == 3 %}high{% elif vulnerability.severity == 2 %}medium{% elif vulnerability.severity == 1 %}low{% else %}info{% endif %}">
                        {{ vulnerability.get_severity_display }}
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">CVSS Score</span>
                    <div class="detail-value">{{ vulnerability.cvss_score }} (AE: {% if vulnerability.has_exposed_asset %}1.0{% else %}0.5{% endif %})</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">True Risk Score</span>
                    <div class="detail-value">
                        <span class="risk-score {% if vulnerability.true_risk_score is not None %}{% if vulnerability.true_risk_score > 7.5 %}critical{% elif vulnerability.true_risk_score > 5 %}high{% elif vulnerability.true_risk_score > 2.5 %}medium{% else %}low{% endif %}{% else %}n-a{% endif %}">
                            {{ vulnerability.true_risk_score|floatformat:5|default:"N/A" }}
                        </span>
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Discovered Date</span>
                    <div class="detail-value">{{ vulnerability.discovered_date }}</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Affected Asset</span>
                    <div class="detail-value">{{ vulnerability.affected_asset }}</div>
                </div>
            </div>

            <div>
                <div class="detail-item">
                    <span class="detail-label">Protocol</span>
                    <div class="detail-value">{{ vulnerability.protocol|default:"N/A" }}</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Risk Factor</span>
                    <div class="detail-value">{{ vulnerability.risk_factor|default:"N/A" }}</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">EPSS</span>
                    <div class="detail-value">{{ vulnerability.epss|default:"N/A" }}</div>
                </div>
            </div>
        </div>

            <div class="detail-item">
                <span class="detail-label">CVE</span>
                <div class="detail-value">{{ vulnerability.cve|default:"N/A" }}</div>
            </div>

            <div class="detail-section">
                <h3 class="detail-section-title">Description</h3>
                <div class="description-card">
                    <div class="detail-value">
                        {{ vulnerability.description|linebreaks }}
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3 class="detail-section-title">Remediation</h3>
                <div class="remediation-card">
                    <div class="detail-value">
                        {{ vulnerability.remediation|linebreaks }}
                    </div>
                </div>
            </div>

            {% if vulnerability.see_also %}
            <div class="detail-section">
                <h3 class="detail-section-title">See Also</h3>
                <div class="description-card">
                    <div class="detail-value">
                        <a href="{{ vulnerability.see_also}}">{{ vulnerability.see_also|linebreaks }}</a>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if vulnerability.xref %}
            <div class="detail-section">
                <h3 class="detail-section-title">Cross References</h3>
                <div class="description-card">
                    <div class="detail-value">
                        {{ vulnerability.xref|linebreaks }}
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Reported By</span>
                    <div class="detail-value">{{ vulnerability.analyst.first_name }} {{ vulnerability.analyst.last_name }}</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Created</span>
                    <div class="detail-value">{{ vulnerability.created_at }}</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Last Updated</span>
                    <div class="detail-value">{{ vulnerability.updated_at }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
